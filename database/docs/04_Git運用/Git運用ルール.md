# Git運用ルールとコンフリクト解消ガイド

このドキュメントは、チーム開発を円滑に進めるためのGitブランチ戦略と、コンフリクト（競合）が発生した際の対処法を定めます。

---

## 1. 基本的なブランチモデル（Git-flow簡易版）

シンプルで管理しやすいように、以下の3種類のブランチを基本として運用します。

- **`main`ブランチ**
    - **役割:** 常に正常に動作する、安定した製品版のコードを保管します。
    - **ルール:**
        - このブランチに直接コミット（`git commit`）することは**絶対に禁止**です。
        - `develop`ブランチから、リリース準備が整ったものだけをマージします。

- **`develop`ブランチ**
    - **役割:** 開発のベースとなるブランチ。次にリリースされる可能性のある機能がすべて統合されています。
    - **ルール:**
        - このブランチにも直接コミットすることは**原則禁止**です。
        - 後述する`feature`ブランチから、機能が完成するたびにマージ（Pull Request）されます。
        - 開発者は、作業を始める前に必ずこのブランチを最新の状態にします (`git pull origin develop`)。

- **`feature`ブランチ** (トピックブランチとも呼びます)
    - **役割:** 個々の機能開発やタスクを行うためのブランチです。**作業はすべてこのブランチで行います。**
    - **命名規則:** `feature/` のプレフィックスの後に、分かりやすいタスク名を付けます。
        - 例: `feature/create-top-page` （トップページ作成）
        - 例: `feature/login-validation` （ログインのバリデーション実装）
        - 例: `fix/header-style` （バグ修正の場合）
    - **ルール:**
        - 必ず最新の`develop`ブランチから作成します。
        - 作業が完了したら、`develop`ブランチへの**Pull Request (PR)** を作成します。
        - PRがマージされたら、このブランチは削除して構いません。

---

## 2. 具体的な作業フロー

**【作業開始時】**
```bash
# 1. まず、ローカルのdevelopブランチを最新の状態にする
git checkout develop
git pull origin develop

# 2. これから作業する内容のfeatureブランチを作成する
git checkout -b feature/task-name  # 例: feature/create-about-page
```

**【作業中】**
```bash
# ファイルを編集したら...
git add .
git commit -m "feat: Aboutページの基本レイアウトを作成" # コミットメッセージは分かりやすく

# 作業の区切りが良いところで、リモートリポジトリにプッシュしておく
# (これにより、PCが壊れてもコードが失われない)
git push origin feature/task-name
```

**【作業完了後】**
1.  作業が完了したら、GitHub上で`develop`ブランチに向けた**Pull Request (PR)** を作成します。
2.  PRのレビュー担当者を指名します（チーム内でルールを決めておく）。
3.  レビューでOKが出たら、PRをマージします。
4.  これであなたの作業が`develop`ブランチに統合されました。

---

## 3. コンフリクト（競合）とその対策

コンフリクトは、**複数の人が同じファイルの同じ箇所を同時に変更した**ときに発生します。これを避けるための工夫と、起きてしまったときの対処法を覚えましょう。

### 3.1. コンフリクトが起きやすい箇所と予防策

1.  **`routes/web.php` (ルーティングファイル)**
    - **原因:** 複数のメンバーが同時に新しいページやAPIのルートを追加するため、競合の最有力候補です。
    - **予防策:**
        - **作業範囲を明確に分ける:** 「Aさんはユーザー認証周り」「Bさんは病院紹介ページ」のように、担当箇所を明確に分けます。
        - **こまめにPull & Push:** 作業を始める前と、区切りの良いタイミングで`develop`ブランチの最新の変更を取り込む (`git pull`) 習慣をつけます。

2.  **`database/migrations/...` (マイグレーションファイル)**
    - **原因:** 複数のメンバーが同じテーブルにカラムを追加・変更しようとすると発生します。
    - **予防策:**
        - **DB設計はリーダーが一括管理:** 開発計画書通り、DBの構造変更（マイグレーション作成）はリーダーが責任を持って行い、他のメンバーは触らないルールにするのが最も安全です。

3.  **共通コンポーネント (`resources/views/layouts/app.blade.php`など)**
    - **原因:** ヘッダーやフッターなど、全員が使うファイルを同時に編集してしまう。
    - **予防策:**
        - **担当者を決める:** 共通部分の変更は、特定の担当者（例: Blade化チームのリーダー）に依頼するルールにします。
        - **変更前には必ず`git pull`:** 共通ファイルを触る前には、必ず`develop`の最新状態を確認します。

### 3.2. コンフリクトが発生した場合の解消フロー

コンフリクトは、Pull Requestをマージしようとした時や、`git pull` をした時に発覚します。

**シナリオ: `feature/my-task` で作業後、`develop`をpullしたらコンフリクトした！**

1.  **慌てない:** まず、どのファイルでコンフリクトが起きているかメッセージを確認します。

2.  **コンフリクト箇所を修正:** エディタでコンフリクトしたファイルを開くと、以下のように表示されています。
    ```
    <<<<<<< HEAD
    // developブランチの変更内容 (自分の変更前の状態)
    =======
    // 自分がfeatureブランチで加えた変更内容
    >>>>>>> feature/my-task
    ```
    - `<<<<<<<`, `=======`, `>>>>>>>` のマーカーを**すべて削除**します。
    - 両方の変更内容を見比べて、**どちらを残すか、あるいは両方をどう組み合わせるか**を判断し、ファイルを最終的にあるべき姿に編集します。
    - **重要:** どのコードを残すべきか判断に迷う場合は、**必ずもう一方のコードを書いた担当者に相談してください。** 勝手に消してしまうと、他の人の作業を破壊する可能性があります。

3.  **修正をコミット:** ファイルの修正が終わったら、通常通りコミットします。
    ```bash
    git add . # 修正したファイルをステージング
    git commit -m "fix: developとのコンフリクトを解消"
    ```

4.  **プッシュ:** これでコンフリクトは解消されました。作業を続けて、準備ができたらプッシュします。
    ```bash
    git push origin feature/my-task
    ```

---

## 4. 画像ファイル管理ルール

### 4.1. ディレクトリ構造

画像ファイルのコンフリクトを防ぐため、以下のディレクトリ構造に従って画像を管理します。

```
public/images/
├── common/          # 共通画像（ロゴ、アイコンなど）
├── pages/
│   ├── home/        # トップページ用画像
│   ├── about/       # 病院紹介ページ用画像
│   ├── voices/      # お客様の声用画像
│   └── admin/       # 管理画面用画像
└── temp/            # 開発中の一時画像
```

### 4.2. 命名規則

画像ファイルは以下の命名規則に従ってください：

```
{ページ名}_{用途}_{連番}.{拡張子}

例:
- home_hero_01.jpg        (トップページのヒーロー画像)
- about_staff_01.png      (病院紹介ページのスタッフ写真)
- voices_customer_01.jpg  (お客様の声の写真)
- common_logo.png         (共通ロゴ)
```

### 4.3. 画像追加時のルール

1. **自分の担当ページディレクトリのみに追加**
   - 自分が担当するページのディレクトリ（例: `pages/home/`）のみに画像を追加してください
   - 他の担当者のディレクトリには画像を追加しないでください

2. **共通画像の追加は事前相談**
   - `common/`ディレクトリへの画像追加は、チーム全体に影響するため事前にSlack/Discordで相談してください
   - 共通画像の管理責任者を決めておくことを推奨します

3. **プッシュ前の確認**
   - 画像を追加した際は、プッシュ前に必ず`git pull origin develop`を実行してください
   - 他のメンバーが追加した画像が自動的に同期されます

### 4.4. なぜコンフリクトしないのか

異なるディレクトリに異なるファイル名で画像を保存することで：
- **Aさん:** `pages/home/hero.jpg` を追加
- **Bさん:** `pages/about/hero.jpg` を追加

この場合、同じファイル名でも異なるパスのため、Gitはコンフリクトとして扱いません。

### 4.5. 画像ファイルのベストプラクティス

1. **ファイルサイズを最適化**
   - 大きすぎる画像はリポジトリサイズを圧迫します
   - Web用に適切なサイズ（幅1920px以下）と品質で保存してください

2. **不要な画像は削除**
   - テスト用や古い画像は定期的に削除してください
   - `temp/`ディレクトリは定期的にクリーンアップしてください

3. **バックアップを意識**
   - 重要な画像の元ファイルは、Gitとは別の場所にもバックアップを保存することを推奨します
